# Generated block drawing as Python module (keep layer color & real block name)
BLOCK_NAME = r"TPLT20M_15_XA_X2_6B_ngang"
LAYERS = {
    "L1": {"color": 7},
    "0": {"color": 7},
    "Xà": {"color": 2},
}

def _get_doc(layout):
    return getattr(layout, 'doc', None) or getattr(layout, 'drawing', None)

def _ensure_layers(doc):
    for name, attrs in LAYERS.items():
        if name in doc.layers:
            lay = doc.layers.get(name)
            if 'color' in attrs:
                lay.color = attrs['color']
        else:
            doc.layers.new(name, dxfattribs={'color': attrs.get('color', 7)})

def _draw_into(layout):
    layout.add_line((221.0939055005884, 428.8764807270998), (220.768905500634, 488.8764807271), dxfattribs={ "layer": "L1" })
    layout.add_line((31.00037942441122, 488.8764807271), (30.67537942434138, 428.8764807270998), dxfattribs={ "layer": "L1" })
    layout.add_line((220.768905500634, 488.8764807271), (31.00037942441122, 488.8764807271), dxfattribs={ "layer": "0" })
    layout.add_line((30.20476757069991, 488.8764807271), (30.19721335281793, 428.8766205904212), dxfattribs={ "layer": "Xà" })
    layout.add_line((-79.77777295584292, 391.1619574096585), (-79.77777295584292, 30.13777995697092), dxfattribs={ "layer": "Xà" })
    layout.add_line((-13.62039549577366, 34.99420403867044), (-81.04476906200578, 34.99420403867044), dxfattribs={ "layer": "Xà" })
    layout.add_line((-79.61016300802294, 32.12999345619028), (-13.62039549577366, 32.12999345619028), dxfattribs={ "layer": "Xà" })
    layout.add_line((-79.77777295584292, 30.13777995697092), (-10.43074018853076, 30.13777995697092), dxfattribs={ "layer": "Xà" })
    layout.add_line((-79.77777295584292, 36.04545258477811), (-10.43074018853076, 36.04545258477811), dxfattribs={ "layer": "Xà" })
    layout.add_line((-13.62039549577366, -53.79919512400011), (-13.62039549577366, 34.99420403867044), dxfattribs={ "layer": "Xà" })
    layout.add_line((-13.62039549577366, 32.12999345619028), (-13.62039549577366, -53.79919512400011), dxfattribs={ "layer": "Xà" })
    layout.add_line((-16.33841281752393, 36.04545258477811), (-16.33841281752393, -59.14686997017998), dxfattribs={ "layer": "Xà" })
    layout.add_line((-10.43074018853076, 36.04545258477811), (-10.43074018853076, -59.14686997017998), dxfattribs={ "layer": "Xà" })
    layout.add_line((-62.84888241947829, 485.2294480881373), (7.879093484443727, 485.2294480881373), dxfattribs={ "layer": "Xà" })
    layout.add_line((14.6473825020812, 402.731446387188), (-81.98878597006842, 402.731446387188), dxfattribs={ "layer": "Xà" })
    layout.add_line((-81.98878597006842, 477.0857113864986), (14.6473825020812, 477.0857113864986), dxfattribs={ "layer": "Xà" })
    layout.add_line((17.86304686781659, 399.5157820231798), (-85.20445033589112, 399.5157820231798), dxfattribs={ "layer": "Xà" })
    layout.add_line((-85.20445033589112, 480.3013757523294), (17.86304686781659, 480.3013757523294), dxfattribs={ "layer": "Xà" })
    layout.add_line((20.00682311064065, 397.3720057795872), (-87.3482265794728, 397.3720057795872), dxfattribs={ "layer": "Xà" })
    layout.add_line((-87.3482265794728, 482.4451519959201), (20.00682311064065, 482.4451519959201), dxfattribs={ "layer": "Xà" })
    layout.add_line((24.29437559789221, 393.0844532920001), (-91.63577906681076, 393.0844532920001), dxfattribs={ "layer": "Xà" })
    layout.add_line((-91.63577906681076, 486.7327044835092), (24.29437559789221, 486.7327044835092), dxfattribs={ "layer": "Xà" })
    layout.add_line((15.71927062345003, 401.6595582671707), (-83.06067409228034, 401.6595582671707), dxfattribs={ "layer": "Xà" })
    layout.add_line((-83.06067409228034, 478.1575995086605), (15.71927062345003, 478.1575995086605), dxfattribs={ "layer": "Xà" })
    layout.add_line((25.36626372004685, 392.0125651702491), (-92.70766718817958, 392.0125651702491), dxfattribs={ "layer": "Xà" })
    layout.add_line((-92.70766718817958, 487.8045926052599), (25.36626372004685, 487.8045926052599), dxfattribs={ "layer": "Xà" })
    layout.add_line((26.4381518415612, 390.9406770484094), (-93.77955530963571, 390.9406770484094), dxfattribs={ "layer": "Xà" })
    layout.add_line((-93.77955530963571, 488.8764807271), (26.4381518415612, 488.8764807271), dxfattribs={ "layer": "Xà" })
    layout.add_line((22.15059935495174, 395.2282295355981), (-89.49200282244325, 395.2282295355981), dxfattribs={ "layer": "Xà" })
    layout.add_line((-89.49200282244325, 484.5889282395201), (22.15059935495174, 484.5889282395201), dxfattribs={ "layer": "Xà" })
    layout.add_line((21.07871123285531, 396.300117657749), (-88.42011470107626, 396.300117657749), dxfattribs={ "layer": "Xà" })
    layout.add_line((-88.42011470107626, 483.5170401180785), (21.07871123285531, 483.5170401180785), dxfattribs={ "layer": "Xà" })
    layout.add_line((18.93493498918633, 398.4438939014182), (-86.27633845740547, 398.4438939014182), dxfattribs={ "layer": "Xà" })
    layout.add_line((-86.27633845740547, 481.3732638758208), (18.93493498918633, 481.3732638758208), dxfattribs={ "layer": "Xà" })
    layout.add_line((16.79115874560466, 400.58767014359), (-84.13256221373742, 400.58767014359), dxfattribs={ "layer": "Xà" })
    layout.add_line((-84.13256221373742, 479.2294876304895), (16.79115874560466, 479.2294876304895), dxfattribs={ "layer": "Xà" })
    layout.add_line((23.22248747652338, 394.156341415579), (-90.5638909445988, 394.156341415579), dxfattribs={ "layer": "Xà" })
    layout.add_line((-90.5638909445988, 485.6608163616708), (23.22248747652338, 485.6608163616708), dxfattribs={ "layer": "Xà" })
    layout.add_line((-81.98878597006842, 402.731446387188), (-81.98878597006842, 477.0857113864986), dxfattribs={ "layer": "Xà" })
    layout.add_line((-85.20445033589112, 399.5157820231798), (-85.20445033589112, 480.3013757523294), dxfattribs={ "layer": "Xà" })
    layout.add_line((-87.3482265794728, 397.3720057795872), (-87.3482265794728, 482.4451519959201), dxfattribs={ "layer": "Xà" })
    layout.add_line((-91.63577906681076, 393.0844532920001), (-91.63577906681076, 486.7327044835092), dxfattribs={ "layer": "Xà" })
    layout.add_line((-83.06067409228034, 401.6595582671707), (-83.06067409228034, 478.1575995086605), dxfattribs={ "layer": "Xà" })
    layout.add_line((-92.70766718817958, 392.0125651702491), (-92.70766718817958, 487.8045926052599), dxfattribs={ "layer": "Xà" })
    layout.add_line((-93.77955530963571, 390.9406770484094), (-93.77955530963571, 488.8764807271), dxfattribs={ "layer": "Xà" })
    layout.add_line((-89.49200282244325, 395.2282295355981), (-89.49200282244325, 484.5889282395201), dxfattribs={ "layer": "Xà" })
    layout.add_line((-88.42011470107626, 396.300117657749), (-88.42011470107626, 483.5170401180785), dxfattribs={ "layer": "Xà" })
    layout.add_line((-86.27633845740547, 398.4438939014182), (-86.27633845740547, 481.3732638758208), dxfattribs={ "layer": "Xà" })
    layout.add_line((-84.13256221373742, 400.58767014359), (-84.13256221373742, 479.2294876304895), dxfattribs={ "layer": "Xà" })
    layout.add_line((-90.5638909445988, 394.156341415579), (-90.5638909445988, 485.6608163616708), dxfattribs={ "layer": "Xà" })
    layout.add_line((14.6473825020812, 477.0857113864986), (14.6473825020812, 402.731446387188), dxfattribs={ "layer": "Xà" })
    layout.add_line((17.86304686781659, 480.3013757523294), (17.86304686781659, 399.5157820231798), dxfattribs={ "layer": "Xà" })
    layout.add_line((20.00682311064065, 482.4451519959201), (20.00682311064065, 397.3720057795872), dxfattribs={ "layer": "Xà" })
    layout.add_line((24.29437559789221, 486.7327044835092), (24.29437559789221, 393.0844532920001), dxfattribs={ "layer": "Xà" })
    layout.add_line((15.71927062345003, 478.1575995086605), (15.71927062345003, 401.6595582671707), dxfattribs={ "layer": "Xà" })
    layout.add_line((25.36626372004685, 487.8045926052599), (25.36626372004685, 392.0125651702491), dxfattribs={ "layer": "Xà" })
    layout.add_line((26.4381518415612, 488.8764807271), (26.4381518415612, 390.9406770484094), dxfattribs={ "layer": "Xà" })
    layout.add_line((22.15059935495174, 484.5889282395201), (22.15059935495174, 395.2282295355981), dxfattribs={ "layer": "Xà" })
    layout.add_line((21.07871123285531, 483.5170401180785), (21.07871123285531, 396.300117657749), dxfattribs={ "layer": "Xà" })
    layout.add_line((18.93493498918633, 481.3732638758208), (18.93493498918633, 398.4438939014182), dxfattribs={ "layer": "Xà" })
    layout.add_line((16.79115874560466, 479.2294876304895), (16.79115874560466, 400.58767014359), dxfattribs={ "layer": "Xà" })
    layout.add_line((23.22248747652338, 485.6608163616708), (23.22248747652338, 394.156341415579), dxfattribs={ "layer": "Xà" })
    layout.add_line((-11.34828244372329, -57.62731388907923), (-17.25595507257094, -57.62731388907923), dxfattribs={ "layer": "Xà" })
    layout.add_line((-19.16293457591291, -4.656182424980213), (178.3239730501518, -4.668030623901358), dxfattribs={ "layer": "Xà" })
    layout.add_line((178.3239730501518, -4.668030623901358), (178.3239730501518, -10.78939495037048), dxfattribs={ "layer": "Xà" })
    layout.add_line((178.3239730501518, -10.78939495037048), (-19.16293457591291, -10.77754675144024), dxfattribs={ "layer": "Xà" })
    layout.add_line((-19.16293457591291, -10.77754675144024), (-19.16293457591291, -4.656182424980213), dxfattribs={ "layer": "Xà" })
    layout.add_line((222.467599847253, 488.8764807271), (30.20476757069991, 488.8764807271), dxfattribs={ "layer": "0" })
    layout.add_line((221.5645167443581, 488.8656775316703), (221.565296390022, 428.8658169244699), dxfattribs={ "layer": "Xà" })
    layout.add_line((331.5360236426786, 391.1387367305307), (331.4952604753353, 30.11456157912836), dxfattribs={ "layer": "Xà" })
    layout.add_line((265.3384317747996, 34.97845544602024), (332.7628049112545, 34.97084257356983), dxfattribs={ "layer": "Xà" })
    layout.add_line((331.3278754689818, 32.10679399044057), (265.3381083774001, 32.1142448818191), dxfattribs={ "layer": "Xà" })
    layout.add_line((331.4952604753353, 30.11456157912836), (262.1482281500803, 30.12239153868904), dxfattribs={ "layer": "Xà" })
    layout.add_line((331.4959275094289, 36.02223416920971), (262.1488951841466, 36.03006412877039), dxfattribs={ "layer": "Xà" })
    layout.add_line((265.3284061300064, -53.8149431505808), (265.3384317747996, 34.97845544602024), dxfattribs={ "layer": "Xà" })
    layout.add_line((265.3381083774001, 32.1142448818191), (265.3284061300064, -53.8149431505808), dxfattribs={ "layer": "Xà" })
    layout.add_line((268.0565677754212, 36.02939709468774), (268.0458196294067, -59.16292485354278), dxfattribs={ "layer": "Xà" })
    layout.add_line((262.1488951841466, 36.03006412877039), (262.1381470381312, -59.16225781946014), dxfattribs={ "layer": "Xà" })
    layout.add_line((314.6177543556687, 485.2081382470187), (243.8897789026232, 485.2161241285703), dxfattribs={ "layer": "Xà" })
    layout.add_line((237.1121750953471, 402.7188871596591), (333.7483429514841, 402.7079759892711), dxfattribs={ "layer": "Xà" })
    layout.add_line((333.7567382765856, 477.0622405145878), (237.1205704204485, 477.0731516850592), dxfattribs={ "layer": "Xà" })
    layout.add_line((233.8961476700642, 399.5035858961601), (336.9636442167248, 399.4919485658083), dxfattribs={ "layer": "Xà" })
    layout.add_line((336.9727657018657, 480.2775417798293), (233.9052691552061, 480.2891791102593), dxfattribs={ "layer": "Xà" })
    layout.add_line((231.7521293875034, 397.3600517195191), (339.1071783933585, 397.3479302824708), dxfattribs={ "layer": "Xà" })
    layout.add_line((339.1167839852132, 482.4210759564703), (231.7617349793581, 482.4331973935986), dxfattribs={ "layer": "Xà" })
    layout.add_line((227.4640928208983, 393.072983366008), (343.3942467466259, 393.0598937155701), dxfattribs={ "layer": "Xà" })
    layout.add_line((343.4048205518202, 486.7081443100596), (227.4746666261499, 486.7212339605885), dxfattribs={ "layer": "Xà" })
    layout.add_line((236.0401659541103, 401.6471200731992), (334.8201100402366, 401.6359668493803), dxfattribs={ "layer": "Xà" })
    layout.add_line((334.8287474186955, 478.1340076032702), (236.0488033325681, 478.1451608270089), dxfattribs={ "layer": "Xà" })
    layout.add_line((226.3920836788757, 392.0012162777402), (344.4660138345362, 391.9878845738513), dxfattribs={ "layer": "Xà" })
    layout.add_line((344.4768296931143, 487.7799113983383), (226.4028995374829, 487.7932431021399), dxfattribs={ "layer": "Xà" })
    layout.add_line((225.3200745375798, 390.9294491894489), (345.5377809224156, 390.9158754322198), dxfattribs={ "layer": "Xà" })
    layout.add_line((345.5488388343511, 488.8516784866988), (225.3311324495153, 488.8652522438603), dxfattribs={ "layer": "Xà" })
    layout.add_line((229.6081111034591, 395.2165175425707), (341.2507125692937, 395.2039119988222), dxfattribs={ "layer": "Xà" })
    layout.add_line((341.260802267745, 484.5646101331076), (229.6182008019969, 484.5772156768579), dxfattribs={ "layer": "Xà" })
    layout.add_line((230.6801202454799, 396.2882846312496), (340.1789454814143, 396.2759211408375), dxfattribs={ "layer": "Xà" })
    layout.add_line((340.1887931265965, 483.4928430451401), (230.689967890693, 483.5052065356303), dxfattribs={ "layer": "Xà" })
    layout.add_line((232.8241385287402, 398.4318188078887), (338.0354113047515, 398.4199394241003), dxfattribs={ "layer": "Xà" })
    layout.add_line((338.0447748431907, 481.3493088699288), (232.8335020672384, 481.3611882537097), dxfattribs={ "layer": "Xà" })
    layout.add_line((234.9681568120868, 400.5753529830197), (335.8918771281169, 400.5639577060082), dxfattribs={ "layer": "Xà" })
    layout.add_line((335.9007565599313, 479.2057746916289), (234.9770362438722, 479.2171699686385), dxfattribs={ "layer": "Xà" })
    layout.add_line((228.536101962135, 394.1447504560274), (342.3224796578734, 394.1319028589278), dxfattribs={ "layer": "Xà" })
    layout.add_line((342.3328114097967, 485.63637722171), (228.5464337140302, 485.6492248188897), dxfattribs={ "layer": "Xà" })
    layout.add_line((333.7483429514841, 402.7079759892711), (333.7567382765856, 477.0622405145878), dxfattribs={ "layer": "Xà" })
    layout.add_line((336.9636442167248, 399.4919485658083), (336.9727657018657, 480.2775417798293), dxfattribs={ "layer": "Xà" })
    layout.add_line((339.1071783933585, 397.3479302824708), (339.1167839852132, 482.4210759564703), dxfattribs={ "layer": "Xà" })
    layout.add_line((343.3942467466259, 393.0598937155701), (343.4048205518202, 486.7081443100596), dxfattribs={ "layer": "Xà" })
    layout.add_line((334.8201100402366, 401.6359668493803), (334.8287474186955, 478.1340076032702), dxfattribs={ "layer": "Xà" })
    layout.add_line((344.4660138345362, 391.9878845738513), (344.4768296931143, 487.7799113983383), dxfattribs={ "layer": "Xà" })
    layout.add_line((345.5377809224156, 390.9158754322198), (345.5488388343511, 488.8516784866988), dxfattribs={ "layer": "Xà" })
    layout.add_line((341.2507125692937, 395.2039119988222), (341.260802267745, 484.5646101331076), dxfattribs={ "layer": "Xà" })
    layout.add_line((340.1789454814143, 396.2759211408375), (340.1887931265965, 483.4928430451401), dxfattribs={ "layer": "Xà" })
    layout.add_line((338.0354113047515, 398.4199394241003), (338.0447748431907, 481.3493088699288), dxfattribs={ "layer": "Xà" })
    layout.add_line((335.8918771281169, 400.5639577060082), (335.9007565599313, 479.2057746916289), dxfattribs={ "layer": "Xà" })
    layout.add_line((342.3224796578734, 394.1319028589278), (342.3328114097967, 485.63637722171), dxfattribs={ "layer": "Xà" })
    layout.add_line((237.1205704204485, 477.0731516850592), (237.1121750953471, 402.7188871596591), dxfattribs={ "layer": "Xà" })
    layout.add_line((233.9052691552061, 480.2891791102593), (233.8961476700642, 399.5035858961601), dxfattribs={ "layer": "Xà" })
    layout.add_line((231.7617349793581, 482.4331973935986), (231.7521293875034, 397.3600517195191), dxfattribs={ "layer": "Xà" })
    layout.add_line((227.4746666261499, 486.7212339605885), (227.4640928208983, 393.072983366008), dxfattribs={ "layer": "Xà" })
    layout.add_line((236.0488033325681, 478.1451608270089), (236.0401659541103, 401.6471200731992), dxfattribs={ "layer": "Xà" })
    layout.add_line((226.4028995374829, 487.7932431021399), (226.3920836788757, 392.0012162777402), dxfattribs={ "layer": "Xà" })
    layout.add_line((225.3311324495153, 488.8652522438603), (225.3200745375798, 390.9294491894489), dxfattribs={ "layer": "Xà" })
    layout.add_line((229.6182008019969, 484.5772156768579), (229.6081111034591, 395.2165175425707), dxfattribs={ "layer": "Xà" })
    layout.add_line((230.689967890693, 483.5052065356303), (230.6801202454799, 396.2882846312496), dxfattribs={ "layer": "Xà" })
    layout.add_line((232.8335020672384, 481.3611882537097), (232.8241385287402, 398.4318188078887), dxfattribs={ "layer": "Xà" })
    layout.add_line((234.9770362438722, 479.2171699686385), (234.9681568120868, 400.5753529830197), dxfattribs={ "layer": "Xà" })
    layout.add_line((228.5464337140302, 485.6492248188897), (228.536101962135, 394.1447504560274), dxfattribs={ "layer": "Xà" })
    layout.add_line((263.0558608603169, -57.64280534747921), (268.9635334515042, -57.6434723816401), dxfattribs={ "layer": "Xà" })
    layout.add_line((286.2796537527257, 488.8595456340389), (286.2788633859746, 481.8595619960506), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((286.2796537527257, 488.8595456340389), (286.2744747652041, 442.9911840672485), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((304.8891584137173, 488.8574444385795), (267.6701490917485, 488.8616468294713), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((270.6506038721272, -4.670482294630346), (178.3246648810027, -4.662106563318957), dxfattribs={ "layer": "Xà" })
    layout.add_line((178.3246648810027, -4.662106563318957), (178.3239737190451, -10.78347085079076), dxfattribs={ "layer": "Xà" })
    layout.add_line((178.3239737190451, -10.78347085079076), (270.6499127100842, -10.7918465820203), dxfattribs={ "layer": "Xà" })
    layout.add_line((270.6499127100842, -10.7918465820203), (270.6506038721272, -4.670482294630346), dxfattribs={ "layer": "Xà" })
    layout.add_line((-33.60028885814973, 490.3726890340695), (-33.66572176009504, 483.3730111777693), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((-33.60028885814973, 490.3726890340695), (-34.02904700390263, 444.5063311440572), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((-52.20898059644969, 490.5466428540803), (-14.9915971198634, 490.1987352140695), dxfattribs={ "layer": "0", "color": 7 })

def add_to_drawing(msp):
    _doc = _get_doc(msp)
    if _doc is not None:
        _ensure_layers(_doc)
    _draw_into(msp)

def register_block(doc):
    _ensure_layers(doc)
    if BLOCK_NAME in doc.blocks:
        blk = doc.blocks.get(BLOCK_NAME)
        # Xoá nội dung cũ? Không: giữ nguyên để an toàn.
    else:
        blk = doc.blocks.new(name=BLOCK_NAME)
    _draw_into(blk)

def insert_block(msp, insert=(0, 0), rotation_deg=0, scale=1.0, layer='0'):
    doc = _get_doc(msp)
    if doc is None:
        raise RuntimeError('Không lấy được document từ layout.')
    if BLOCK_NAME not in doc.blocks:
        register_block(doc)
    ref = msp.add_blockref(BLOCK_NAME, insert, dxfattribs={'layer': layer})
    try:
        ref.dxf.rotation = rotation_deg
        ref.dxf.xscale = scale
        ref.dxf.yscale = scale
    except Exception:
        pass
