# Generated block drawing as Python module (keep layer color & real block name)
BLOCK_NAME = r"TPLT20M_15_XA_X2_6B_ngang_2"
LAYERS = {
    "L1": {"color": 7},
    "0": {"color": 7},
    "Xà": {"color": 2},
}

def _get_doc(layout):
    return getattr(layout, 'doc', None) or getattr(layout, 'drawing', None)

def _ensure_layers(doc):
    for name, attrs in LAYERS.items():
        if name in doc.layers:
            lay = doc.layers.get(name)
            if 'color' in attrs:
                lay.color = attrs['color']
        else:
            doc.layers.new(name, dxfattribs={'color': attrs.get('color', 7)})

def _draw_into(layout):
    layout.add_line((215.6700362200156, 442.3115568666617), (215.3450362199458, 502.3115568666617), dxfattribs={ "layer": "L1" })
    layout.add_line((25.57651014372368, 502.3115568666617), (25.2515101436527, 442.3115568666617), dxfattribs={ "layer": "L1" })
    layout.add_line((215.3450362199458, 502.3115568666617), (25.57651014372368, 502.3115568666617), dxfattribs={ "layer": "0" })
    layout.add_line((25.08418576619579, 502.3115568666617), (24.76189485078271, 442.3116967299828), dxfattribs={ "layer": "Xà" })
    layout.add_line((216.1131328272118, 502.3115568666617), (25.08418576619579, 502.3115568666617), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((216.1206870450637, 442.3116967299828), (216.1131328272118, 502.3115568666617), dxfattribs={ "layer": "Xà" })
    layout.add_line((216.4354248706315, 442.3116967299828), (216.1131328272118, 502.3115568666617), dxfattribs={ "layer": "Xà" })
    layout.add_line((-21.15666041666327, -9.817542472768764), (258.1433997544166, -8.397795334887633), dxfattribs={ "layer": "Xà" })
    layout.add_line((-21.15666041666327, 10.18831906658124), (258.1433997544166, 11.60806620438234), dxfattribs={ "layer": "Xà" })
    layout.add_line((223.0954129214458, 499.0958925012328), (223.0954129214458, 407.5914175551406), dxfattribs={ "layer": "Xà" })
    layout.add_line((229.5267416523075, 492.6645637700511), (229.5267416523075, 414.0227462831517), dxfattribs={ "layer": "Xà" })
    layout.add_line((227.3829654086396, 494.8083400153826), (227.3829654086396, 411.8789700409797), dxfattribs={ "layer": "Xà" })
    layout.add_line((225.2391891651146, 496.9521162576401), (225.2391891651146, 409.7351937973106), dxfattribs={ "layer": "Xà" })
    layout.add_line((224.1673010428729, 498.0240043790818), (224.1673010428729, 408.6633056751598), dxfattribs={ "layer": "Xà" })
    layout.add_line((219.8797485564967, 502.3115568666617), (219.8797485564967, 404.375753187971), dxfattribs={ "layer": "Xà" })
    layout.add_line((220.9516366778346, 501.2396687448217), (220.9516366778346, 405.4476413098107), dxfattribs={ "layer": "Xà" })
    layout.add_line((230.5986297745207, 491.5926756482222), (230.5986297745207, 415.0946344067324), dxfattribs={ "layer": "Xà" })
    layout.add_line((222.0235248000776, 500.1677806230708), (222.0235248000776, 406.5195294315616), dxfattribs={ "layer": "Xà" })
    layout.add_line((226.3110772872697, 495.8802281354818), (226.3110772872697, 410.8070819191486), dxfattribs={ "layer": "Xà" })
    layout.add_line((228.4548535302108, 493.7364518918911), (228.4548535302108, 412.9508581627415), dxfattribs={ "layer": "Xà" })
    layout.add_line((231.6705178959767, 490.5207875260603), (231.6705178959767, 416.1665225267497), dxfattribs={ "layer": "Xà" })
    layout.add_line((336.8817913425687, 407.5914175551406), (336.8817913425687, 499.0958925012328), dxfattribs={ "layer": "Xà" })
    layout.add_line((330.4504626116198, 414.0227462831517), (330.4504626116198, 492.6645637700511), dxfattribs={ "layer": "Xà" })
    layout.add_line((332.5942388552876, 411.8789700409797), (332.5942388552876, 494.8083400153826), dxfattribs={ "layer": "Xà" })
    layout.add_line((334.7380150989006, 409.7351937973106), (334.7380150989006, 496.9521162576401), dxfattribs={ "layer": "Xà" })
    layout.add_line((335.8099032203286, 408.6633056751598), (335.8099032203286, 498.0240043790818), dxfattribs={ "layer": "Xà" })
    layout.add_line((340.0974557076068, 404.375753187971), (340.0974557076068, 502.3115568666617), dxfattribs={ "layer": "Xà" })
    layout.add_line((339.0255675862377, 405.4476413098107), (339.0255675862377, 501.2396687448217), dxfattribs={ "layer": "Xà" })
    layout.add_line((329.3785744902507, 415.0946344067324), (329.3785744902507, 491.5926756482222), dxfattribs={ "layer": "Xà" })
    layout.add_line((337.9536794646356, 406.5195294315616), (337.9536794646356, 500.1677806230708), dxfattribs={ "layer": "Xà" })
    layout.add_line((333.6661269774428, 410.8070819191486), (333.6661269774428, 495.8802281354818), dxfattribs={ "layer": "Xà" })
    layout.add_line((331.5223507338617, 412.9508581627415), (331.5223507338617, 493.7364518918911), dxfattribs={ "layer": "Xà" })
    layout.add_line((328.3066863680957, 416.1665225267497), (328.3066863680957, 490.5207875260603), dxfattribs={ "layer": "Xà" })
    layout.add_line((336.8817913425687, 499.0958925012328), (223.0954129214458, 499.0958925012328), dxfattribs={ "layer": "Xà" })
    layout.add_line((223.0954129214458, 407.5914175551406), (336.8817913425687, 407.5914175551406), dxfattribs={ "layer": "Xà" })
    layout.add_line((330.4504626116198, 492.6645637700511), (229.5267416523075, 492.6645637700511), dxfattribs={ "layer": "Xà" })
    layout.add_line((229.5267416523075, 414.0227462831517), (330.4504626116198, 414.0227462831517), dxfattribs={ "layer": "Xà" })
    layout.add_line((332.5942388552876, 494.8083400153826), (227.3829654086396, 494.8083400153826), dxfattribs={ "layer": "Xà" })
    layout.add_line((227.3829654086396, 411.8789700409797), (332.5942388552876, 411.8789700409797), dxfattribs={ "layer": "Xà" })
    layout.add_line((334.7380150989006, 496.9521162576401), (225.2391891651146, 496.9521162576401), dxfattribs={ "layer": "Xà" })
    layout.add_line((225.2391891651146, 409.7351937973106), (334.7380150989006, 409.7351937973106), dxfattribs={ "layer": "Xà" })
    layout.add_line((335.8099032203286, 498.0240043790818), (224.1673010428729, 498.0240043790818), dxfattribs={ "layer": "Xà" })
    layout.add_line((224.1673010428729, 408.6633056751598), (335.8099032203286, 408.6633056751598), dxfattribs={ "layer": "Xà" })
    layout.add_line((340.0974557076068, 502.3115568666617), (219.8797485564967, 502.3115568666617), dxfattribs={ "layer": "Xà" })
    layout.add_line((219.8797485564967, 404.375753187971), (340.0974557076068, 404.375753187971), dxfattribs={ "layer": "Xà" })
    layout.add_line((339.0255675862377, 501.2396687448217), (220.9516366778346, 501.2396687448217), dxfattribs={ "layer": "Xà" })
    layout.add_line((220.9516366778346, 405.4476413098107), (339.0255675862377, 405.4476413098107), dxfattribs={ "layer": "Xà" })
    layout.add_line((329.3785744902507, 491.5926756482222), (230.5986297745207, 491.5926756482222), dxfattribs={ "layer": "Xà" })
    layout.add_line((230.5986297745207, 415.0946344067324), (329.3785744902507, 415.0946344067324), dxfattribs={ "layer": "Xà" })
    layout.add_line((337.9536794646356, 500.1677806230708), (222.0235248000776, 500.1677806230708), dxfattribs={ "layer": "Xà" })
    layout.add_line((222.0235248000776, 406.5195294315616), (337.9536794646356, 406.5195294315616), dxfattribs={ "layer": "Xà" })
    layout.add_line((333.6661269774428, 495.8802281354818), (226.3110772872697, 495.8802281354818), dxfattribs={ "layer": "Xà" })
    layout.add_line((226.3110772872697, 410.8070819191486), (333.6661269774428, 410.8070819191486), dxfattribs={ "layer": "Xà" })
    layout.add_line((331.5223507338617, 493.7364518918911), (228.4548535302108, 493.7364518918911), dxfattribs={ "layer": "Xà" })
    layout.add_line((228.4548535302108, 412.9508581627415), (331.5223507338617, 412.9508581627415), dxfattribs={ "layer": "Xà" })
    layout.add_line((328.3066863680957, 490.5207875260603), (231.6705178959767, 490.5207875260603), dxfattribs={ "layer": "Xà" })
    layout.add_line((231.6705178959767, 416.1665225267497), (328.3066863680957, 416.1665225267497), dxfattribs={ "layer": "Xà" })
    layout.add_line((309.1667828175366, 498.6645242276988), (238.4388069135255, 498.6645242276988), dxfattribs={ "layer": "Xà" })
    layout.add_line((256.7486405864997, 49.48052872433982), (256.7486405864997, -45.71179383061823), dxfattribs={ "layer": "Xà" })
    layout.add_line((262.6563132153478, 49.48052872433982), (262.6563132153478, -45.71179383061823), dxfattribs={ "layer": "Xà" })
    layout.add_line((259.9382958937438, 45.56506959575199), (259.9382958937438, -40.36411898443839), dxfattribs={ "layer": "Xà" })
    layout.add_line((259.9382958937438, -40.36411898443839), (259.9382958937438, 48.42928017823215), dxfattribs={ "layer": "Xà" })
    layout.add_line((326.0956733539006, 49.48052872433982), (256.7486405864997, 49.48052872433982), dxfattribs={ "layer": "Xà" })
    layout.add_line((326.0956733539006, 43.57285609653263), (256.7486405864997, 43.57285609653263), dxfattribs={ "layer": "Xà" })
    layout.add_line((325.9280634060797, 45.56506959575199), (259.9382958937438, 45.56506959575199), dxfattribs={ "layer": "Xà" })
    layout.add_line((259.9382958937438, 48.42928017823215), (327.3626694599177, 48.42928017823215), dxfattribs={ "layer": "Xà" })
    layout.add_line((326.0956733539006, 404.5970335492202), (326.0956733539006, 43.57285609653263), dxfattribs={ "layer": "Xà" })
    layout.add_line((261.7387709603008, -44.19223774951752), (255.8310983313077, -44.19223774951752), dxfattribs={ "layer": "Xà" })
    layout.add_line((-81.13173903129633, 404.5970335492202), (-81.13173903129633, 43.57285609653263), dxfattribs={ "layer": "Xà" })
    layout.add_line((-14.97436157122638, 48.42928017823215), (-82.39873513737142, 48.42928017823215), dxfattribs={ "layer": "Xà" })
    layout.add_line((-80.96412908338812, 45.56506959575199), (-14.97436157122638, 45.56506959575199), dxfattribs={ "layer": "Xà" })
    layout.add_line((-81.13173903129633, 43.57285609653263), (-11.78470626389549, 43.57285609653263), dxfattribs={ "layer": "Xà" })
    layout.add_line((-81.13173903129633, 49.48052872433982), (-11.78470626389549, 49.48052872433982), dxfattribs={ "layer": "Xà" })
    layout.add_line((-14.97436157122638, -40.36411898443839), (-14.97436157122638, 48.42928017823215), dxfattribs={ "layer": "Xà" })
    layout.add_line((-14.97436157122638, 45.56506959575199), (-14.97436157122638, -40.36411898443839), dxfattribs={ "layer": "Xà" })
    layout.add_line((-17.69237889288843, 49.48052872433982), (-17.69237889288843, -45.71179383061823), dxfattribs={ "layer": "Xà" })
    layout.add_line((-11.78470626389549, 49.48052872433982), (-11.78470626389549, -45.71179383061823), dxfattribs={ "layer": "Xà" })
    layout.add_line((-64.20284849484413, 498.6645242276988), (6.525127409021706, 498.6645242276988), dxfattribs={ "layer": "Xà" })
    layout.add_line((13.29341642671556, 416.1665225267497), (-83.34275204549112, 416.1665225267497), dxfattribs={ "layer": "Xà" })
    layout.add_line((-83.34275204549112, 490.5207875260603), (13.29341642671556, 490.5207875260603), dxfattribs={ "layer": "Xà" })
    layout.add_line((16.50908079245164, 412.9508581627415), (-86.55841641125721, 412.9508581627415), dxfattribs={ "layer": "Xà" })
    layout.add_line((-86.55841641125721, 493.7364518918911), (16.50908079245164, 493.7364518918911), dxfattribs={ "layer": "Xà" })
    layout.add_line((18.65285703524773, 410.8070819191486), (-88.7021926549264, 410.8070819191486), dxfattribs={ "layer": "Xà" })
    layout.add_line((-88.7021926549264, 495.8802281354818), (18.65285703524773, 495.8802281354818), dxfattribs={ "layer": "Xà" })
    layout.add_line((22.94040952252681, 406.5195294315616), (-92.98974514220524, 406.5195294315616), dxfattribs={ "layer": "Xà" })
    layout.add_line((-92.98974514220524, 500.1677806230708), (22.94040952252681, 500.1677806230708), dxfattribs={ "layer": "Xà" })
    layout.add_line((14.36530454808462, 415.0946344067324), (-84.41464016773236, 415.0946344067324), dxfattribs={ "layer": "Xà" })
    layout.add_line((-84.41464016773236, 491.5926756482222), (14.36530454808462, 491.5926756482222), dxfattribs={ "layer": "Xà" })
    layout.add_line((24.01229764459458, 405.4476413098107), (-94.06163326354452, 405.4476413098107), dxfattribs={ "layer": "Xà" })
    layout.add_line((-94.06163326354452, 501.2396687448217), (24.01229764459458, 501.2396687448217), dxfattribs={ "layer": "Xà" })
    layout.add_line((25.08418576619579, 404.375753187971), (-95.13352138500136, 404.375753187971), dxfattribs={ "layer": "Xà" })
    layout.add_line((-95.13352138500136, 502.3115568666617), (25.08418576619579, 502.3115568666617), dxfattribs={ "layer": "Xà" })
    layout.add_line((20.79663327955677, 408.6633056751598), (-90.84596889780939, 408.6633056751598), dxfattribs={ "layer": "Xà" })
    layout.add_line((-90.84596889780939, 498.0240043790818), (20.79663327955677, 498.0240043790818), dxfattribs={ "layer": "Xà" })
    layout.add_line((19.72474515740145, 409.7351937973106), (-89.77408077635322, 409.7351937973106), dxfattribs={ "layer": "Xà" })
    layout.add_line((-89.77408077635322, 496.9521162576401), (19.72474515740145, 496.9521162576401), dxfattribs={ "layer": "Xà" })
    layout.add_line((17.5809689138207, 411.8789700409797), (-87.63030453277158, 411.8789700409797), dxfattribs={ "layer": "Xà" })
    layout.add_line((-87.63030453277158, 494.8083400153826), (17.5809689138207, 494.8083400153826), dxfattribs={ "layer": "Xà" })
    layout.add_line((15.4371926702388, 414.0227462831517), (-85.48652828918831, 414.0227462831517), dxfattribs={ "layer": "Xà" })
    layout.add_line((-85.48652828918831, 492.6645637700511), (15.4371926702388, 492.6645637700511), dxfattribs={ "layer": "Xà" })
    layout.add_line((21.86852140109976, 407.5914175551406), (-91.91785701996444, 407.5914175551406), dxfattribs={ "layer": "Xà" })
    layout.add_line((-91.91785701996444, 499.0958925012328), (21.86852140109976, 499.0958925012328), dxfattribs={ "layer": "Xà" })
    layout.add_line((-83.34275204549112, 416.1665225267497), (-83.34275204549112, 490.5207875260603), dxfattribs={ "layer": "Xà" })
    layout.add_line((-86.55841641125721, 412.9508581627415), (-86.55841641125721, 493.7364518918911), dxfattribs={ "layer": "Xà" })
    layout.add_line((-88.7021926549264, 410.8070819191486), (-88.7021926549264, 495.8802281354818), dxfattribs={ "layer": "Xà" })
    layout.add_line((-92.98974514220524, 406.5195294315616), (-92.98974514220524, 500.1677806230708), dxfattribs={ "layer": "Xà" })
    layout.add_line((-84.41464016773236, 415.0946344067324), (-84.41464016773236, 491.5926756482222), dxfattribs={ "layer": "Xà" })
    layout.add_line((-94.06163326354452, 405.4476413098107), (-94.06163326354452, 501.2396687448217), dxfattribs={ "layer": "Xà" })
    layout.add_line((-95.13352138500136, 404.375753187971), (-95.13352138500136, 502.3115568666617), dxfattribs={ "layer": "Xà" })
    layout.add_line((-90.84596889780939, 408.6633056751598), (-90.84596889780939, 498.0240043790818), dxfattribs={ "layer": "Xà" })
    layout.add_line((-89.77408077635322, 409.7351937973106), (-89.77408077635322, 496.9521162576401), dxfattribs={ "layer": "Xà" })
    layout.add_line((-87.63030453277158, 411.8789700409797), (-87.63030453277158, 494.8083400153826), dxfattribs={ "layer": "Xà" })
    layout.add_line((-85.48652828918831, 414.0227462831517), (-85.48652828918831, 492.6645637700511), dxfattribs={ "layer": "Xà" })
    layout.add_line((-91.91785701996444, 407.5914175551406), (-91.91785701996444, 499.0958925012328), dxfattribs={ "layer": "Xà" })
    layout.add_line((13.29341642671556, 490.5207875260603), (13.29341642671556, 416.1665225267497), dxfattribs={ "layer": "Xà" })
    layout.add_line((16.50908079245164, 493.7364518918911), (16.50908079245164, 412.9508581627415), dxfattribs={ "layer": "Xà" })
    layout.add_line((18.65285703524773, 495.8802281354818), (18.65285703524773, 410.8070819191486), dxfattribs={ "layer": "Xà" })
    layout.add_line((22.94040952252681, 500.1677806230708), (22.94040952252681, 406.5195294315616), dxfattribs={ "layer": "Xà" })
    layout.add_line((14.36530454808462, 491.5926756482222), (14.36530454808462, 415.0946344067324), dxfattribs={ "layer": "Xà" })
    layout.add_line((24.01229764459458, 501.2396687448217), (24.01229764459458, 405.4476413098107), dxfattribs={ "layer": "Xà" })
    layout.add_line((25.08418576619579, 502.3115568666617), (25.08418576619579, 404.375753187971), dxfattribs={ "layer": "Xà" })
    layout.add_line((20.79663327955677, 498.0240043790818), (20.79663327955677, 408.6633056751598), dxfattribs={ "layer": "Xà" })
    layout.add_line((19.72474515740145, 496.9521162576401), (19.72474515740145, 409.7351937973106), dxfattribs={ "layer": "Xà" })
    layout.add_line((17.5809689138207, 494.8083400153826), (17.5809689138207, 411.8789700409797), dxfattribs={ "layer": "Xà" })
    layout.add_line((15.4371926702388, 492.6645637700511), (15.4371926702388, 414.0227462831517), dxfattribs={ "layer": "Xà" })
    layout.add_line((21.86852140109976, 499.0958925012328), (21.86852140109976, 407.5914175551406), dxfattribs={ "layer": "Xà" })
    layout.add_line((-12.70224851908824, -44.19223774951752), (-18.6099211480232, -44.19223774951752), dxfattribs={ "layer": "Xà" })
    layout.add_line((-35.86433579276331, 502.3127319421401), (-35.86433579276331, 495.3127482595209), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((-35.86433579276331, 502.3127319421401), (-35.86433579276331, 456.4443700829833), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((-54.47384057237446, 502.3127319421401), (-17.25483101316536, 502.3127319421401), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((277.0616528625637, 502.289690267331), (277.0606220031716, 495.289706660631), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((277.0616528625637, 502.289690267331), (277.0548980137337, 456.4213289055605), dxfattribs={ "layer": "0", "color": 7 })
    layout.add_line((295.6711574403837, 502.2869497205501), (258.4521482847577, 502.292430814121), dxfattribs={ "layer": "0", "color": 7 })

def add_to_drawing(msp):
    _doc = _get_doc(msp)
    if _doc is not None:
        _ensure_layers(_doc)
    _draw_into(msp)

def register_block(doc):
    _ensure_layers(doc)
    if BLOCK_NAME in doc.blocks:
        blk = doc.blocks.get(BLOCK_NAME)
        # Xoá nội dung cũ? Không: giữ nguyên để an toàn.
    else:
        blk = doc.blocks.new(name=BLOCK_NAME)
    _draw_into(blk)

def insert_block(msp, insert=(0, 0), rotation_deg=0, scale=1.0, layer='0'):
    doc = _get_doc(msp)
    if doc is None:
        raise RuntimeError('Không lấy được document từ layout.')
    if BLOCK_NAME not in doc.blocks:
        register_block(doc)
    ref = msp.add_blockref(BLOCK_NAME, insert, dxfattribs={'layer': layer})
    try:
        ref.dxf.rotation = rotation_deg
        ref.dxf.xscale = scale
        ref.dxf.yscale = scale
    except Exception:
        pass
