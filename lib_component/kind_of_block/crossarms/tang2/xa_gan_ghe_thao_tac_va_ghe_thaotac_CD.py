# Generated block drawing as Python module (keep layer color & real block name)
BLOCK_NAME = r"xa_gan_ghe_thao_tac_va_ghe_thaotac_CD"
LAYERS = {
    "BAO": {"color": 3},
    "DANTRAM": {"color": 7},
    "0": {"color": 7},
    "DUONGTAM": {"color": 8},
    "NETKHUAT": {"color": 9},
    "LOPHAN": {"color": 2},
}

def _get_doc(layout):
    return getattr(layout, 'doc', None) or getattr(layout, 'drawing', None)

def _ensure_layers(doc):
    for name, attrs in LAYERS.items():
        if name in doc.layers:
            lay = doc.layers.get(name)
            if 'color' in attrs:
                lay.color = attrs['color']
        else:
            doc.layers.new(name, dxfattribs={'color': attrs.get('color', 7)})

def _draw_into(layout):
    layout.add_line((-43.07729117476992, 32.97416482780864), (1478.055659305559, 32.97416482780864), dxfattribs={ "layer": "BAO", "color": 8 })
    layout.add_line((-43.07729117476992, 39.97416482780863), (1478.055659305559, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((-43.07729117476992, -35.02583517219136), (1173.890696886134, -35.02583517219136), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((-43.07729117476992, 2.474164827808635), (1478.055659305559, 2.474164827808635), dxfattribs={ "layer": "0", "color": 8 })
    layout.add_line((1435.883201239885, 46.75733248292272), (1435.883201239885, 26.52092338408147), dxfattribs={ "layer": "DUONGTAM" })
    layout.add_line((1426.883201239885, 39.97416482780863), (1426.883201239885, 32.97416482780864), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((1444.883201239885, 39.97416482780863), (1444.883201239885, 32.97416482780864), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((1465.383201239885, 105.9741648278086), (1465.383201239885, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1406.383201239885, 112.9741648278086), (1406.383201239885, 46.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1399.383201239885, 105.9741648278086), (1465.383201239885, 105.9741648278086), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1418.883201239885, 105.9741648278086), (1418.883201239885, 112.9741648278086), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((1452.883201239885, 105.9741648278086), (1452.883201239885, 112.9741648278086), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((1444.883201239885, 112.9741648278086), (1426.883201239885, 112.9741648278086), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1435.883201239885, 118.0412351983486), (1435.883201239885, 100.6512215552739), dxfattribs={ "layer": "DUONGTAM" })
    layout.add_line((1472.383201239885, 112.9741648278086), (1472.383201239885, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1399.383201239885, 112.9741648278086), (1472.383201239885, 112.9741648278086), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1399.383201239885, 112.9741648278086), (1399.383201239885, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1406.383201239885, 46.97416482780863), (1472.383201239885, 46.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1452.883201239885, 46.97416482780863), (1452.883201239885, 39.97416482780863), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((1418.883201239885, 46.97416482780863), (1418.883201239885, 39.97416482780863), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((1435.883201239885, 34.90709445726861), (1435.883201239885, 52.29710810034339), dxfattribs={ "layer": "DUONGTAM" })
    layout.add_line((1478.055659305559, -35.02583517219136), (1478.055659305559, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1262.646208187005, 32.97416482780864), (1345.359974333456, 32.97416482780864), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1258.576314555037, -35.02583517219136), (1478.055659305559, -35.02583517219136), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((888.0556593055588, 39.97416482780863), (1428.055659305559, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1457.047542990905, 1225.767465873412), (1104.047542990906, 1225.767465873412), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((1164.047542990905, 855.7674658734121), (1452.047542990906, 855.7674658734121), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((1164.047542990905, 841.7674658734123), (1452.047542990906, 841.7674658734123), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((1407.047542990905, 485.7674658734122), (1457.047542990905, 425.7674658734122), dxfattribs={ "layer": "LOPHAN" })
    layout.add_line((1407.047542990905, 1225.767465873412), (1407.047542990905, 485.7674658734122), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1457.047542990905, 1225.767465873412), (1457.047542990905, 425.7674658734122), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((1150.047542990906, 1211.767465873412), (1150.047542990906, 431.7674658734122), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((1164.047542990905, 1211.767465873412), (1164.047542990905, 431.7674658734122), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((1452.047542990906, 1225.767465873412), (1452.047542990906, 425.7674658734122), dxfattribs={ "layer": "BAO", "color": 8 })
    layout.add_line((907.0475429909055, 485.7674658734122), (857.0475429909055, 425.7674658734122), dxfattribs={ "layer": "LOPHAN" })
    layout.add_line((907.0475429909055, 1225.767465873412), (907.0475429909055, 485.7674658734122), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((857.0475429909055, 1225.767465873412), (857.0475429909055, 425.7674658734122), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((862.0475429909056, 1225.767465873412), (862.0475429909056, 425.7674658734122), dxfattribs={ "layer": "BAO", "color": 8 })
    layout.add_line((862.0475429909056, 855.7674658734121), (1150.047542990906, 855.7674658734121), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((862.0475429909056, 841.7674658734123), (1150.047542990906, 841.7674658734123), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((907.0475429909055, 485.7674658734122), (1407.047542990905, 485.7674658734122), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((857.0475429909055, 425.7674658734122), (1457.047542990905, 425.7674658734122), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((857.0475429909055, 431.7674658734122), (1457.047542990905, 431.7674658734122), dxfattribs={ "layer": "BAO", "color": 8 })
    layout.add_line((874.0712106372448, 425.7674658734122), (1440.023875344566, 425.7674658734122), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((857.0475429909055, 1225.767465873412), (1457.047542990905, 1225.767465873412), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((862.0475429909056, 1211.767465873412), (1452.047542990906, 1211.767465873412), dxfattribs={ "layer": "DANTRAM", "color": 1 })
    layout.add_line((878.211884741926, 46.75733248292272), (878.211884741926, 26.52092338408147), dxfattribs={ "layer": "DUONGTAM" })
    layout.add_line((887.211884741926, 39.97416482780863), (887.211884741926, 32.97416482780864), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((869.211884741926, 39.97416482780863), (869.211884741926, 32.97416482780864), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((848.711884741926, 105.9741648278086), (848.711884741926, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((907.711884741926, 112.9741648278086), (907.711884741926, 46.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((914.711884741926, 105.9741648278086), (848.711884741926, 105.9741648278086), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((895.211884741926, 105.9741648278086), (895.211884741926, 112.9741648278086), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((861.211884741926, 105.9741648278086), (861.211884741926, 112.9741648278086), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((869.211884741926, 112.9741648278086), (887.211884741926, 112.9741648278086), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((878.211884741926, 118.0412351983486), (878.211884741926, 100.6512215552739), dxfattribs={ "layer": "DUONGTAM" })
    layout.add_line((841.711884741926, 112.9741648278086), (841.711884741926, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((914.711884741926, 112.9741648278086), (841.711884741926, 112.9741648278086), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((914.711884741926, 112.9741648278086), (914.711884741926, 39.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((907.711884741926, 46.97416482780863), (841.711884741926, 46.97416482780863), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((861.211884741926, 46.97416482780863), (861.211884741926, 39.97416482780863), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((895.211884741926, 46.97416482780863), (895.211884741926, 39.97416482780863), dxfattribs={ "layer": "NETKHUAT" })
    layout.add_line((878.211884741926, 34.90709445726861), (878.211884741926, 52.29710810034339), dxfattribs={ "layer": "DUONGTAM" })
    layout.add_line((495.3732875189962, -597.5258351721913), (1304.00309126023, 32.97416482780864), dxfattribs={ "layer": "0", "color": 8 })
    layout.add_line((528.7993292480459, -606.848170477815), (1345.359974333456, 32.97416482780864), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((480.8145718744708, -566.0258351721913), (1262.646208187005, 32.97416482780864), dxfattribs={ "layer": "DANTRAM" })
    layout.add_line((485.3845487672588, -569.9136766296923), (1270.523709724795, 32.97416482780864), dxfattribs={ "layer": "BAO", "color": 8 })
    # Unsupported entity type: SPLINE
    layout.add_line((792.3804405593328, 163.5995631167661), (964.043328925789, 163.5995631167643), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((889.3638552578705, -24.05323273386784), (867.0599142272513, -24.05323273386784), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((858.2098026390486, 78.3028377295941), (858.2098026390486, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((889.3638552578705, 163.5995631167661), (891.553599355986, 90.6080931770939), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((867.0599142272513, 163.5995631167661), (864.8701701291355, 90.6080931770939), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((878.2118847425627, 72.58724492674446), 17.83458465180841, 47.70716374776997, 132.2928362498744, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((894.2135504251163, 85.1090355964916), 4.05625459455433, 9.517877242200692, 170.4821227577993, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((898.2139668448034, 78.3028377295941), (898.2139668448034, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((890.2131340016203, 78.3028377295941), (890.2131340016203, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((866.2106354809621, 78.3028377295941), (866.2106354809621, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((891.553599355986, 90.6080931770939), (864.8701701291355, 90.6080931770939), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((891.553599355986, 90.6080931770939), (895.770976741849, 88.85438265606354), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((864.8701701291355, 90.6080931770939), (860.6527927407332, 88.85438265606354), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((862.2102190587357, 85.1090355964916), 4.056254594554931, 9.517877242200692, 170.4821227577993, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((889.3638552578705, 78.3028377295941), (889.3638552578705, -24.05323273386784), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((867.0599142272513, 78.3028377295941), (867.0599142272513, -24.05323273386784), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((793.2241138907921, 224.1217240675542), (963.1996555933582, 224.1217240673123), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((767.0150835191816, 266.012303339734), (989.4086859697635, 266.0123033325799), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((788.0743957605009, 272.2878568415363), 37.87293187959826, 287.1066237858132, 350.462085380788, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((815.1167689514114, 235.2097102854332), 57.11892751284013, 93.93598358265083, 147.365959402542, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((788.0743957605009, 228.1531391170829), 37.87293187959826, 287.1066237858132, 353.8895275345118, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((836.7143763196217, 309.277993119249), 38.99959971836673, 42.41008828276761, 76.01704349442039, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((890.9145612211105, 335.5805867458694), (865.5092082622104, 335.5805867458676), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((845.4418626460028, 329.0655236373786), 18.06983264484528, 87.79221740215914, 219.1326568415198, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((810.2438957358027, 313.7182019424854), 21.5453350235267, 272.5328204135116, 10.54543823632183, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((804.4393298436661, 225.9918390143357), 11.37006590846447, 117.3550458970576, 189.4668568413769, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((817.493428452184, 175.3232361673217), 24.71336443145573, 137.6996760253587, 169.1222266870936, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((858.2098026390486, 78.3028377295941), (898.2139668448034, 78.3028377295941), dxfattribs={ "layer": "0", "color": 2 })
    # Unsupported entity type: SPLINE
    layout.add_arc((968.3493737246207, 272.2878568415363), 37.87293187959826, 189.5379146192119, 252.8933762141869, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((941.3070005337104, 235.2097102854332), 57.11892751284013, 32.63404059745797, 86.06401641734917, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((968.3493737246207, 228.1531391170829), 37.87293187959826, 186.1104724654881, 252.8933762141869, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((919.7093931654999, 309.277993119249), 38.99959971836673, 103.9829565055796, 137.5899117172324, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((910.9819068391189, 329.0655236373786), 18.06983264484528, 320.8673431584802, 92.20778259784088, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((946.1798737493191, 313.7182019424854), 21.5453350235267, 169.4545617636781, 267.4671795864885, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((951.9844396414592, 225.9918390143357), 11.37006590846447, 350.533143158623, 62.64495410294242, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((938.9303410329375, 175.3232361673217), 24.71336443145573, 10.87777331290636, 42.30032397464128, dxfattribs={ "layer": "0", "color": 2 })
    # Unsupported entity type: SPLINE
    layout.add_line((1350.051757057292, 163.5995631167661), (1521.714645423748, 163.5995631167643), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1447.035171755829, -24.05323273386784), (1424.73123072521, -24.05323273386784), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1415.881119137007, 78.3028377295941), (1415.881119137007, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1447.035171755829, 163.5995631167661), (1449.224915853945, 90.6080931770939), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1424.73123072521, 163.5995631167661), (1422.541486627095, 90.6080931770939), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1435.883201240522, 72.58724492674446), 17.83458465180841, 47.70716374776997, 132.2928362498744, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1451.884866923075, 85.1090355964916), 4.05625459455433, 9.517877242200692, 170.4821227577993, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1455.885283342763, 78.3028377295941), (1455.885283342763, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1447.884450499579, 78.3028377295941), (1447.884450499579, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1423.881951978921, 78.3028377295941), (1423.881951978921, 85.77975893481378), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1449.224915853945, 90.6080931770939), (1422.541486627095, 90.6080931770939), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1449.224915853945, 90.6080931770939), (1453.442293239808, 88.85438265606354), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1422.541486627095, 90.6080931770939), (1418.324109238692, 88.85438265606354), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1419.881535556695, 85.1090355964916), 4.056254594554931, 9.517877242200692, 170.4821227577993, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1447.035171755829, 78.3028377295941), (1447.035171755829, -24.05323273386784), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1424.73123072521, 78.3028377295941), (1424.73123072521, -24.05323273386784), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1350.895430388751, 224.1217240675542), (1520.870972091317, 224.1217240673123), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1324.686400017141, 266.012303339734), (1547.080002467723, 266.0123033325799), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1345.74571225846, 272.2878568415363), 37.87293187959826, 287.1066237858132, 350.462085380788, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1372.78808544937, 235.2097102854332), 57.11892751284013, 93.93598358265083, 147.365959402542, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1345.74571225846, 228.1531391170829), 37.87293187959826, 287.1066237858132, 353.8895275345118, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1394.385692817581, 309.277993119249), 38.99959971836673, 42.41008828276761, 76.01704349442039, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1448.58587771907, 335.5805867458694), (1423.18052476017, 335.5805867458676), dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1403.113179143962, 329.0655236373786), 18.06983264484528, 87.79221740215914, 219.1326568415198, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1367.915212233762, 313.7182019424854), 21.5453350235267, 272.5328204135116, 10.54543823632183, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1362.110646341625, 225.9918390143357), 11.37006590846447, 117.3550458970576, 189.4668568413769, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1375.164744950143, 175.3232361673217), 24.71336443145573, 137.6996760253587, 169.1222266870936, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_line((1415.881119137007, 78.3028377295941), (1455.885283342763, 78.3028377295941), dxfattribs={ "layer": "0", "color": 2 })
    # Unsupported entity type: SPLINE
    layout.add_arc((1526.02069022258, 272.2878568415363), 37.87293187959826, 189.5379146192119, 252.8933762141869, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1498.978317031669, 235.2097102854332), 57.11892751284013, 32.63404059745797, 86.06401641734917, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1526.02069022258, 228.1531391170829), 37.87293187959826, 186.1104724654881, 252.8933762141869, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1477.380709663459, 309.277993119249), 38.99959971836673, 103.9829565055796, 137.5899117172324, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1468.653223337078, 329.0655236373786), 18.06983264484528, 320.8673431584802, 92.20778259784088, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1503.851190247278, 313.7182019424854), 21.5453350235267, 169.4545617636781, 267.4671795864885, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1509.655756139418, 225.9918390143357), 11.37006590846447, 350.533143158623, 62.64495410294242, dxfattribs={ "layer": "0", "color": 2 })
    layout.add_arc((1496.601657530897, 175.3232361673217), 24.71336443145573, 10.87777331290636, 42.30032397464128, dxfattribs={ "layer": "0", "color": 2 })

def add_to_drawing(msp):
    _doc = _get_doc(msp)
    if _doc is not None:
        _ensure_layers(_doc)
    _draw_into(msp)

def register_block(doc):
    _ensure_layers(doc)
    if BLOCK_NAME in doc.blocks:
        blk = doc.blocks.get(BLOCK_NAME)
        # Xoá nội dung cũ? Không: giữ nguyên để an toàn.
    else:
        blk = doc.blocks.new(name=BLOCK_NAME)
    _draw_into(blk)

def insert_block(msp, insert=(0, 0), rotation_deg=0, scale=1.0, layer='0'):
    doc = _get_doc(msp)
    if doc is None:
        raise RuntimeError('Không lấy được document từ layout.')
    if BLOCK_NAME not in doc.blocks:
        register_block(doc)
    ref = msp.add_blockref(BLOCK_NAME, insert, dxfattribs={'layer': layer})
    try:
        ref.dxf.rotation = rotation_deg
        ref.dxf.xscale = scale
        ref.dxf.yscale = scale
    except Exception:
        pass
